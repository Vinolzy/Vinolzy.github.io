<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<style>
.AlignLeft { text-align: left; }
.AlignCenter { text-align: center; }
.AlignRight { text-align: right; }
body { font-family: sans-serif; font-size: 11pt; }
img.AutoScale { max-width: 100%; max-height: 100%; }
td { vertical-align: top; padding-left: 4px; padding-right: 4px; }

tr.SectionGap td { font-size: 4px; border-left: none; border-top: none; border-bottom: 1px solid Black; border-right: 1px solid Black; }
tr.SectionAll td { border-left: none; border-top: none; border-bottom: 1px solid Black; border-right: 1px solid Black; }
tr.SectionBegin td { border-left: none; border-top: none; border-right: 1px solid Black; }
tr.SectionEnd td { border-left: none; border-top: none; border-bottom: 1px solid Black; border-right: 1px solid Black; }
tr.SectionMiddle td { border-left: none; border-top: none; border-right: 1px solid Black; }
tr.SubsectionAll td { border-left: none; border-top: none; border-bottom: 1px solid Gray; border-right: 1px solid Black; }
tr.SubsectionEnd td { border-left: none; border-top: none; border-bottom: 1px solid Gray; border-right: 1px solid Black; }
table.fc { border-top: 1px solid Black; border-left: 1px solid Black; width: 100%; font-family: monospace; font-size: 10pt; }
td.TextItemInsigMod { color: #000000; background-color: #EEEEFF; }
td.TextItemInsigOrphan { color: #000000; background-color: #FAEEFF; }
td.TextItemNum { color: #696969; background-color: #F0F0F0; }
td.TextItemSame { color: #000000; background-color: #FFFFFF; }
td.TextItemSigMod { color: #000000; background-color: #FFE3E3; }
td.TextItemSigOrphan { color: #000000; background-color: #F1E3FF; }
.TextSegInsigDiff { color: #0000FF; }
.TextSegReplacedDiff { color: #0000FF; font-style: italic; }
.TextSegSigDiff { color: #FF0000; }
td.TextItemInsigAdd { color: #000000; background-color: #EEEEFF; }
td.TextItemInsigDel { color: #000000; background-color: #EEEEFF; text-decoration: line-through; }
td.TextItemSigAdd { color: #000000; background-color: #FFE3E3; }
td.TextItemSigDel { color: #000000; background-color: #FFE3E3; text-decoration: line-through; }
.TextSegElement_20851_38190_23383 { font-weight: bold; }
.TextSegElement_35782_21035_31526 { }
.TextSegElement_25968_23383 { color: #2E9269; }
.TextSegElement_23383_31526_20018 { color: #3A7726; }
.TextSegElement_27880_37322 { color: #786A41; }
.TextSegElement_25805_20316_31526 { }
.TextSegElement_32553_36827 { }
</style>
<title>文本比较(T)</title>
</head>
<body>
文本比较(T)<br>
已产生： 2025/1/3 1:48:55<br>
&nbsp; &nbsp;
<br>
模式：&nbsp; 全部 &nbsp;
<br>
左边文件： C:\Users\Administrator\Desktop\7015_aa_a13469_before.py &nbsp;
<br>
右边文件： C:\Users\Administrator\Desktop\7015_aa_a13469.py &nbsp;
<br>
<table class="fc" cellspacing="0" cellpadding="0">
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># -*- coding: utf-8 -*-</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># -*- coding: utf-8 -*-</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">&quot;&quot;&quot;# __WOA7015 Alternative Assessment__</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">&quot;&quot;&quot;# __WOA7015 Alternative Assessment__</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">Group: __Learning Machine__</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">Group: __Learning Machine__</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">Final Model</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">Final Model</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">## Import Needed Modules</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">## Import Needed Modules</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">&quot;&quot;&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">&quot;&quot;&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">torch</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">torch</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">time</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">time</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">nn</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">nn</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">nn</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">nn</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">optim</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">optim</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">optim</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">optim</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">functional</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">F</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">functional</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">F</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">data</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">random_split</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">Dataset</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">data</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">random_split</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">Dataset</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torchvision</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">models</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">resnet18</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">VGG16_Weights</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">ResNet18_Weights</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">AlexNet_Weights</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torchvision</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">models</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">resnet18</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">VGG16_Weights</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">ResNet18_Weights</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">AlexNet_Weights</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torchvision</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">models</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">transforms</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torchvision</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">models</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">transforms</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torchvision</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">datasets</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">ImageFolder</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torchvision</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">datasets</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">ImageFolder</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torchvision</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">make_grid</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torchvision</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">make_grid</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">numpy</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">np</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">numpy</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">np</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">matplotlib</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">pyplot</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">plt</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">matplotlib</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">pyplot</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">plt</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">tqdm</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">tqdm</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">tqdm</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">tqdm</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">json</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">json</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">os</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">os</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">sklearn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">model_selection</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">train_test_split</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">sklearn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">model_selection</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">train_test_split</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">sklearn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">metrics</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">sklearn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">metrics</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">f1_score</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">f1_score</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">precision_score</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">precision_score</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">recall_score</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">recall_score</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">confusion_matrix</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">confusion_matrix</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">classification_report</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">classification_report</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">pandas</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">pd</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">pandas</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">pd</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">logging</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">logging</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">datetime</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">datetime</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">datetime</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">datetime</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">math</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">math</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">typing</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">Optional</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">Tuple</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">List</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">Dict</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">Any</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">typing</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">Optional</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">Tuple</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">List</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">Dict</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">Any</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">optim</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">lr_scheduler</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">ReduceLROnPlateau</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">optim</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">lr_scheduler</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">ReduceLROnPlateau</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">tensorboard</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">SummaryWriter</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">tensorboard</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">SummaryWriter</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">io</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">io</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">seaborn</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">sns</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">seaborn</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">sns</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">logging</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">logging</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">io</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">BytesIO</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">io</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">BytesIO</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">PIL</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">Image</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">from</span> <span class="TextSegElement_35782_21035_31526">PIL</span> <span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">Image</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">csv</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">csv</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">pandas</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">pd</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">import</span> <span class="TextSegElement_35782_21035_31526">pandas</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">pd</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># Set the device for training</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># Set the device for training</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">device</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'cuda'</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">is_available</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_23383_31526_20018">'cpu'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">device</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'cuda'</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">is_available</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_23383_31526_20018">'cpu'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">device</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">device</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">&quot;&quot;&quot;## Get Data&quot;&quot;&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">&quot;&quot;&quot;## Get Data&quot;&quot;&quot;</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff"># Baseline: RGB</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">train_data_dataloader_baseline</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Compose</span><span class="TextSegSigDiff">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Resize</span><span class="TextSegSigDiff">((</span><span class="TextSegSigDiff">224</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">224</span><span class="TextSegSigDiff">)),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">RandomHorizontalFlip</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">p</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">0.5</span><span class="TextSegSigDiff">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">RandomApply</span><span class="TextSegSigDiff">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">#</span><span class="TextSegInsigDiff"> Data p</span><span class="TextSegInsigDiff">rep</span><span class="TextSegInsigDiff">rocessing and augmentation</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff"> </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">RandomRotation</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">degrees</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">15</span><span class="TextSegSigDiff">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">ColorJitter</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">brightness</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">0.2</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">contrast</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">0.2</span><span class="TextSegSigDiff">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">RandomAffine</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">degrees</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">0</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">translate</span><span class="TextSegSigDiff">=(</span><span class="TextSegSigDiff">0.1</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.1</span><span class="TextSegSigDiff">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">],</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">p</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">0.2</span><span class="TextSegSigDiff">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">ToTensor</span><span class="TextSegSigDiff">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Normalize</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">mean</span><span class="TextSegSigDiff">=[</span><span class="TextSegSigDiff">0.485</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.456</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.406</span><span class="TextSegSigDiff">],</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">std</span><span class="TextSegSigDiff">=[</span><span class="TextSegSigDiff">0.229</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.224</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.225</span><span class="TextSegSigDiff">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">val_data_dataloader_baseline</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Compose</span><span class="TextSegSigDiff">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Resize</span><span class="TextSegSigDiff">((</span><span class="TextSegSigDiff">224</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">224</span><span class="TextSegSigDiff">)),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">ToTensor</span><span class="TextSegSigDiff">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Normalize</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">mean</span><span class="TextSegSigDiff">=[</span><span class="TextSegSigDiff">0.485</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.456</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.406</span><span class="TextSegSigDiff">],</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">std</span><span class="TextSegSigDiff">=[</span><span class="TextSegSigDiff">0.229</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.224</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.225</span><span class="TextSegSigDiff">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff"># Custom: RGB</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod">data_t<span class="TextSegSigDiff">ransfo</span><span class="TextSegSigDiff">rms</span> = transforms.Compose([</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">train_</span>data_<span class="TextSegSigDiff">da</span>t<span class="TextSegSigDiff">al</span><span class="TextSegSigDiff">oader</span> = transforms.Compose([</td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Resize</span><span class="TextSegElement_25805_20316_31526">((</span>224<span class="TextSegElement_25805_20316_31526">,</span> 224<span class="TextSegElement_25805_20316_31526">)),</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Resize</span><span class="TextSegElement_25805_20316_31526">((</span>224<span class="TextSegElement_25805_20316_31526">,</span> 224<span class="TextSegElement_25805_20316_31526">)),</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSigMod">&nbsp;&nbsp;&nbsp; transforms.RandomHorizontalFlip(),</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod">&nbsp;&nbsp;&nbsp; transforms.RandomHorizontalFlip(<span class="TextSegSigDiff">p</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">0.5</span>),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">RandomApply</span><span class="TextSegSigDiff">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod">&nbsp;&nbsp;&nbsp; transforms.RandomRotation(15),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod">&nbsp;&nbsp; &nbsp;<span class="TextSegSigDiff">&nbsp; &nbsp; </span>transforms.RandomRotation(<span class="TextSegSigDiff">degrees</span><span class="TextSegSigDiff">=</span>15),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # transforms.ColorJitter(brightness=0.2, contrast=0.2),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp;<span class="TextSegInsigDiff">&nbsp; &nbsp; </span># transforms.ColorJitter(brightness=0.2, contrast=0.2),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # transforms.RandomAffine(degrees=0, translate=(0.1, 0.1))<span class="TextSegInsigDiff">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp;<span class="TextSegInsigDiff">&nbsp; &nbsp; </span># transforms.RandomAffine(degrees=0, translate=(0.1, 0.1))</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">],</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">p</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">0.2</span><span class="TextSegSigDiff">),</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ToTensor</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ToTensor</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Normalize</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">=[</span><span class="TextSegElement_25968_23383">0.485</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25968_23383">0.456</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25968_23383">0.406</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">std</span><span class="TextSegElement_25805_20316_31526">=[</span><span class="TextSegElement_25968_23383">0.229</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25968_23383">0.224</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25968_23383">0.225</span><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Normalize</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">=[</span><span class="TextSegElement_25968_23383">0.485</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25968_23383">0.456</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25968_23383">0.406</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">std</span><span class="TextSegElement_25805_20316_31526">=[</span><span class="TextSegElement_25968_23383">0.229</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25968_23383">0.224</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25968_23383">0.225</span><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">#</span><span class="TextSegInsigDiff"> Data prepro</span><span class="TextSegInsigDiff">cessing and augmentation</span></td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">val_data_dataloader</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Compose</span><span class="TextSegSigDiff">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Resize</span><span class="TextSegSigDiff">((</span><span class="TextSegSigDiff">224</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">224</span><span class="TextSegSigDiff">)),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">ToTensor</span><span class="TextSegSigDiff">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Normalize</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">mean</span><span class="TextSegSigDiff">=[</span><span class="TextSegSigDiff">0.485</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.456</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.406</span><span class="TextSegSigDiff">],</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">std</span><span class="TextSegSigDiff">=[</span><span class="TextSegSigDiff">0.229</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.224</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0.225</span><span class="TextSegSigDiff">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff"># Custom: Gray</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod">data_t<span class="TextSegSigDiff">ransfo</span><span class="TextSegSigDiff">rms</span>_gry = transforms.Compose([</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">train_</span>data_<span class="TextSegSigDiff">da</span>t<span class="TextSegSigDiff">al</span><span class="TextSegSigDiff">oader</span>_gry = transforms.Compose([</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Grayscale</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_output_channels</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Grayscale</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_output_channels</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Resize</span><span class="TextSegElement_25805_20316_31526">((</span>224<span class="TextSegElement_25805_20316_31526">,</span> 224<span class="TextSegElement_25805_20316_31526">)),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Resize</span><span class="TextSegElement_25805_20316_31526">((</span>224<span class="TextSegElement_25805_20316_31526">,</span> 224<span class="TextSegElement_25805_20316_31526">)),</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSigMod">&nbsp;&nbsp;&nbsp; transforms.RandomHorizontalFlip(),</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod">&nbsp;&nbsp;&nbsp; transforms.RandomHorizontalFlip(<span class="TextSegSigDiff">p</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">0.5</span>),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">RandomApply</span><span class="TextSegSigDiff">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod">&nbsp;&nbsp;&nbsp; transforms.RandomRotation(15),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod">&nbsp;&nbsp; &nbsp;<span class="TextSegSigDiff">&nbsp; &nbsp; </span>transforms.RandomRotation(<span class="TextSegSigDiff">degrees</span><span class="TextSegSigDiff">=</span>15),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # transforms.ColorJitter(brightness=0.2, contrast=0.2),</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp;<span class="TextSegInsigDiff">&nbsp; &nbsp; </span># transforms.ColorJitter(brightness=0.2, contrast=0.2),</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # transforms.RandomAffine(degrees=0, translate=(0.1, 0.1))<span class="TextSegInsigDiff">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp;<span class="TextSegInsigDiff">&nbsp; &nbsp; </span># transforms.RandomAffine(degrees=0, translate=(0.1, 0.1))</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">],</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">p</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">0.2</span><span class="TextSegSigDiff">),</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ToTensor</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ToTensor</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])</span></td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Normalize</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">mean</span><span class="TextSegSigDiff">=[</span><span class="TextSegSigDiff">0.</span><span class="TextSegSigDiff">5</span><span class="TextSegSigDiff">],</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">std</span><span class="TextSegSigDiff">=[</span><span class="TextSegSigDiff">0.</span><span class="TextSegSigDiff">5</span><span class="TextSegSigDiff">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">val_data_dataloader_gry</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Compose</span><span class="TextSegSigDiff">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Grayscale</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">num_output_channels</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">1</span><span class="TextSegSigDiff">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Resize</span><span class="TextSegSigDiff">((</span><span class="TextSegSigDiff">224</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">224</span><span class="TextSegSigDiff">)),</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">transforms</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">ToTensor</span><span class="TextSegSigDiff">(),</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Normalize</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">=[</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">std</span><span class="TextSegElement_25805_20316_31526">=[</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">transforms</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Normalize</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">=[</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">std</span><span class="TextSegElement_25805_20316_31526">=[</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># dataset: https://drive.google.com/drive/folders/1d1ArqNswahfsmP6h-fm3WCvL47dVOpxA?usp=drive_link</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># dataset: https://drive.google.com/drive/folders/1d1ArqNswahfsmP6h-fm3WCvL47dVOpxA?usp=drive_link</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># Define the base directory for data</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># Define the base directory for data</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">base_data_dir</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'/kaggle/input/brain-tumor-mri-dataset'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">base_data_dir</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'/kaggle/input/brain-tumor-mri-dataset'</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod"># <span class="TextSegInsigDiff">Training </span><span class="TextSegInsigDiff">and validation datasets and loaders</span></td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod"># <span class="TextSegInsigDiff">1.</span><span class="TextSegInsigDiff"> Base</span><span class="TextSegInsigDiff">l</span><span class="TextSegInsigDiff">i</span><span class="TextSegInsigDiff">n</span><span class="TextSegInsigDiff">e:</span><span class="TextSegInsigDiff"> </span><span class="TextSegInsigDiff">RGB</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">train_dataset</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">ImageFolder</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">f</span><span class="TextSegSigDiff">'{base_data_dir}/Training'</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">transform</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">train_data_dataloader_baseline</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">train_loader</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">DataLoader</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">train_dataset</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">batch_size</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">128</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">shuffle</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">True</span><span class="TextSegSigDiff">)</span><span class="TextSegInsigDiff">&nbsp; # batch_size set to 128 due to &quot;CUDA out of memory&quot; when using VGG16 model</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">val_dataset</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">ImageFolder</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">f</span><span class="TextSegSigDiff">'{base_data_dir}/Testing'</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">transform</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">val_data_dataloader_baseline</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">val_loader</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">DataLoader</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">val_dataset</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">batch_size</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">128</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">shuffle</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">False</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff"># 2. Custom: RGB</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod">train_dataset = ImageFolder(f'{base_data_dir}/Training', transform=data_t<span class="TextSegSigDiff">ransfo</span><span class="TextSegSigDiff">rms</span>)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod">train_dataset = ImageFolder(f'{base_data_dir}/Training', transform=<span class="TextSegSigDiff">train_</span>data_<span class="TextSegSigDiff">da</span>t<span class="TextSegSigDiff">al</span><span class="TextSegSigDiff">oader</span>)</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">train_loader</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_dataset</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">batch_size</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">shuffle</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">train_loader</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_dataset</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">batch_size</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">shuffle</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionAll">
<td class="TextItemSigMod">val_dataset = ImageFolder(f'{base_data_dir}/Testing', transform=data_t<span class="TextSegSigDiff">ransfo</span><span class="TextSegSigDiff">rms</span>)</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod">val_dataset = ImageFolder(f'{base_data_dir}/Testing', transform=<span class="TextSegSigDiff">val_</span>data_<span class="TextSegSigDiff">da</span>t<span class="TextSegSigDiff">al</span><span class="TextSegSigDiff">oader</span>)</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">val_loader</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_dataset</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">batch_size</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">shuffle</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">val_loader</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_dataset</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">batch_size</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">shuffle</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod"># <span class="TextSegInsigDiff">Training and validation</span><span class="TextSegInsigDiff"> d</span><span class="TextSegInsigDiff">atasets and loaders</span></td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod"># <span class="TextSegInsigDiff">3.</span><span class="TextSegInsigDiff"> Cus</span><span class="TextSegInsigDiff">t</span><span class="TextSegInsigDiff">om: Gray</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod">train_dataset_gry = ImageFolder(f'{base_data_dir}/Training', transform=data_t<span class="TextSegSigDiff">ransfo</span><span class="TextSegSigDiff">rms</span>_gry)</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod">train_dataset_gry = ImageFolder(f'{base_data_dir}/Training', transform=<span class="TextSegSigDiff">train_</span>data_<span class="TextSegSigDiff">da</span>t<span class="TextSegSigDiff">al</span><span class="TextSegSigDiff">oader</span>_gry)</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">train_loader_gry</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_dataset_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">batch_size</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">shuffle</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">train_loader_gry</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_dataset_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">batch_size</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">shuffle</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionAll">
<td class="TextItemSigMod">val_dataset_gry = ImageFolder(f'{base_data_dir}/Testing', transform=data_t<span class="TextSegSigDiff">ransfo</span><span class="TextSegSigDiff">rms</span>_gry)</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod">val_dataset_gry = ImageFolder(f'{base_data_dir}/Testing', transform=<span class="TextSegSigDiff">val_</span>data_<span class="TextSegSigDiff">da</span>t<span class="TextSegSigDiff">al</span><span class="TextSegSigDiff">oader</span>_gry)</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">val_loader_gry</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_dataset_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">batch_size</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">shuffle</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_35782_21035_31526">val_loader_gry</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_dataset_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">batch_size</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">shuffle</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># Load a batch of images and labels for visualization</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># Load a batch of images and labels for visualization</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># data_iter = iter(train_loader)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># data_iter = iter(train_loader)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># images, labels = next(data_iter)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># images, labels = next(data_iter)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># # Convert images to numpy arrays and denormalize</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># # Convert images to numpy arrays and denormalize</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># mean = np.array([0.485, 0.456, 0.406])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># mean = np.array([0.485, 0.456, 0.406])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># std = np.array([0.229, 0.224, 0.225])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># std = np.array([0.229, 0.224, 0.225])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># images = (images.numpy().transpose((0, 2, 3, 1)) * std + mean).clip(0, 1)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># images = (images.numpy().transpose((0, 2, 3, 1)) * std + mean).clip(0, 1)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># # Create a grid of images</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># # Create a grid of images</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># num_images = len(images)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># num_images = len(images)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># rows = int(np.ceil(num_images / 4))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># rows = int(np.ceil(num_images / 4))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># fig, axes = plt.subplots(rows, 4, figsize=(15, 15))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># fig, axes = plt.subplots(rows, 4, figsize=(15, 15))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># # Plot images with labels</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># # Plot images with labels</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># for i, ax in enumerate(axes.flat):</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># for i, ax in enumerate(axes.flat):</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">#&nbsp; &nbsp;&nbsp; if i &lt; num_images:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">#&nbsp; &nbsp;&nbsp; if i &lt; num_images:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">#&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ax.imshow(images[i])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">#&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ax.imshow(images[i])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">#&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ax.set_title(f'Label: {train_dataset.classes[labels[i]]}')</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">#&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ax.set_title(f'Label: {train_dataset.classes[labels[i]]}')</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">#&nbsp; &nbsp;&nbsp; ax.axis('off')</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">#&nbsp; &nbsp;&nbsp; ax.axis('off')</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># plt.tight_layout()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># plt.tight_layout()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># plt.show()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322"># plt.show()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">&quot;&quot;&quot;## Custom Model Architecture&quot;&quot;&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_23383_31526_20018">&quot;&quot;&quot;## Custom Model Architecture&quot;&quot;&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">EfficientMultiHeadAttention</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">EfficientMultiHeadAttention</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_25968_23383">0.1</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_25968_23383">0.1</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">assert</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span> <span class="TextSegElement_25805_20316_31526">%</span> <span class="TextSegElement_35782_21035_31526">num_heads</span> <span class="TextSegElement_25805_20316_31526">==</span> 0<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">&quot;Embedding dimension must be divisible by number of heads&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">assert</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span> <span class="TextSegElement_25805_20316_31526">%</span> <span class="TextSegElement_35782_21035_31526">num_heads</span> <span class="TextSegElement_25805_20316_31526">==</span> 0<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">&quot;Embedding dimension must be divisible by number of heads&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">embed_dim</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">embed_dim</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">num_heads</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">num_heads</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">num_heads</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">num_heads</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">head_dim</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span> <span class="TextSegElement_25805_20316_31526">//</span> <span class="TextSegElement_35782_21035_31526">num_heads</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">head_dim</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span> <span class="TextSegElement_25805_20316_31526">//</span> <span class="TextSegElement_35782_21035_31526">num_heads</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">scale</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">head_dim</span> <span class="TextSegElement_25805_20316_31526">**</span> <span class="TextSegElement_25805_20316_31526">-</span><span class="TextSegElement_25968_23383">0.5</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">scale</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">head_dim</span> <span class="TextSegElement_25805_20316_31526">**</span> <span class="TextSegElement_25805_20316_31526">-</span><span class="TextSegElement_25968_23383">0.5</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Use a single projection for QKV to reduce computation</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Use a single projection for QKV to reduce computation</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">qkv_proj</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> 3 <span class="TextSegElement_25805_20316_31526">*</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">qkv_proj</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> 3 <span class="TextSegElement_25805_20316_31526">*</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">out_proj</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">out_proj</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">dropout</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">dropout</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">mask</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">None</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">mask</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">None</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">L</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">C</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">shape</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">L</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">C</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">shape</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Efficient QKV projection</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Efficient QKV projection</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">qkv</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">qkv_proj</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">chunk</span><span class="TextSegElement_25805_20316_31526">(</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">=-</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">qkv</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">qkv_proj</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">chunk</span><span class="TextSegElement_25805_20316_31526">(</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">=-</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">q</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">k</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">v</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">map</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_20851_38190_23383">lambda</span> <span class="TextSegElement_35782_21035_31526">t</span>: <span class="TextSegElement_35782_21035_31526">t</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">view</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">L</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">head_dim</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">qkv</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">q</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">k</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">v</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">map</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_20851_38190_23383">lambda</span> <span class="TextSegElement_35782_21035_31526">t</span>: <span class="TextSegElement_35782_21035_31526">t</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">view</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">L</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">head_dim</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">qkv</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Use einsum for more efficient attention computation</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Use einsum for more efficient attention computation</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">attn_weights</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">einsum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'bhqd,bhkd-&gt;bhqk'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">q</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">k</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">*</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">scale</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">attn_weights</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">einsum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'bhqd,bhkd-&gt;bhqk'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">q</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">k</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">*</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">scale</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">mask</span> <span class="TextSegElement_20851_38190_23383">is</span> <span class="TextSegElement_20851_38190_23383">not</span> <span class="TextSegElement_20851_38190_23383">None</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">mask</span> <span class="TextSegElement_20851_38190_23383">is</span> <span class="TextSegElement_20851_38190_23383">not</span> <span class="TextSegElement_20851_38190_23383">None</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">attn_weights</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">attn_weights</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">masked_fill</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">mask</span> <span class="TextSegElement_25805_20316_31526">==</span> 0<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">float</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'-inf'</span><span class="TextSegElement_25805_20316_31526">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">attn_weights</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">attn_weights</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">masked_fill</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">mask</span> <span class="TextSegElement_25805_20316_31526">==</span> 0<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">float</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'-inf'</span><span class="TextSegElement_25805_20316_31526">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">attn_probs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">F</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">softmax</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">attn_weights</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">=-</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">attn_probs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">F</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">softmax</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">attn_weights</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">=-</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">attn_probs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">attn_probs</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">attn_probs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">attn_probs</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">context</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">einsum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'bhqk,bhkd-&gt;bhqd'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">attn_probs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">v</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">context</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">einsum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'bhqk,bhkd-&gt;bhqd'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">attn_probs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">v</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">context</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">context</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">contiguous</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">view</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">L</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">C</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">context</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">context</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">contiguous</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">view</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">L</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">C</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">out_proj</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">context</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">out_proj</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">context</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">TransformerBlock</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">TransformerBlock</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">mlp_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_25968_23383">0.1</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">mlp_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_25968_23383">0.1</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">attention</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">EfficientMultiHeadAttention</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">attention</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">EfficientMultiHeadAttention</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">norm1</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">LayerNorm</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">norm1</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">LayerNorm</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">norm2</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">LayerNorm</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">norm2</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">LayerNorm</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mlp</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mlp</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">mlp_dim</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">mlp_dim</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">GELU</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">GELU</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">mlp_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">mlp_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">dropout</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">attention</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">norm1</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">attention</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">norm1</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mlp</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">norm2</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mlp</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">norm2</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">x</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">x</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">RotaryPositionalEmbedding</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">RotaryPositionalEmbedding</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">base</span><span class="TextSegElement_25805_20316_31526">=</span>10000<span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">base</span><span class="TextSegElement_25805_20316_31526">=</span>10000<span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">inv_freq</span> <span class="TextSegElement_25805_20316_31526">=</span> 1<span class="TextSegElement_25805_20316_31526">.</span> <span class="TextSegElement_25805_20316_31526">/</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">base</span> <span class="TextSegElement_25805_20316_31526">**</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">arange</span><span class="TextSegElement_25805_20316_31526">(</span>0<span class="TextSegElement_25805_20316_31526">.,</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">.)</span> <span class="TextSegElement_25805_20316_31526">/</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">inv_freq</span> <span class="TextSegElement_25805_20316_31526">=</span> 1<span class="TextSegElement_25805_20316_31526">.</span> <span class="TextSegElement_25805_20316_31526">/</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">base</span> <span class="TextSegElement_25805_20316_31526">**</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">arange</span><span class="TextSegElement_25805_20316_31526">(</span>0<span class="TextSegElement_25805_20316_31526">.,</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">.)</span> <span class="TextSegElement_25805_20316_31526">/</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">register_buffer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'inv_freq'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">inv_freq</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">register_buffer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'inv_freq'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">inv_freq</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">seq_dim</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">seq_dim</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">t</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">arange</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">shape</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">seq_dim</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">type_as</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">inv_freq</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">t</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">arange</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">shape</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">seq_dim</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">type_as</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">inv_freq</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">sinusoid_inp</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">einsum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">&quot;i,j-&gt;ij&quot;</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">t</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">inv_freq</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">sinusoid_inp</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">einsum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">&quot;i,j-&gt;ij&quot;</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">t</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">inv_freq</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cat</span><span class="TextSegElement_25805_20316_31526">((</span><span class="TextSegElement_35782_21035_31526">sinusoid_inp</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">sin</span><span class="TextSegElement_25805_20316_31526">(),</span> <span class="TextSegElement_35782_21035_31526">sinusoid_inp</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cos</span><span class="TextSegElement_25805_20316_31526">()),</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">=-</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cat</span><span class="TextSegElement_25805_20316_31526">((</span><span class="TextSegElement_35782_21035_31526">sinusoid_inp</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">sin</span><span class="TextSegElement_25805_20316_31526">(),</span> <span class="TextSegElement_35782_21035_31526">sinusoid_inp</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cos</span><span class="TextSegElement_25805_20316_31526">()),</span> <span class="TextSegElement_35782_21035_31526">dim</span><span class="TextSegElement_25805_20316_31526">=-</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">emb</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_20851_38190_23383">None</span><span class="TextSegElement_25805_20316_31526">,</span> :<span class="TextSegElement_25805_20316_31526">,</span> :<span class="TextSegElement_25805_20316_31526">]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">emb</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_20851_38190_23383">None</span><span class="TextSegElement_25805_20316_31526">,</span> :<span class="TextSegElement_25805_20316_31526">,</span> :<span class="TextSegElement_25805_20316_31526">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">HybridFPNTransformer_gry</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">HybridFPNTransformer_gry</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">image_size</span><span class="TextSegElement_25805_20316_31526">=</span>224<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">patch_size</span><span class="TextSegElement_25805_20316_31526">=</span>16<span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">image_size</span><span class="TextSegElement_25805_20316_31526">=</span>224<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">patch_size</span><span class="TextSegElement_25805_20316_31526">=</span>16<span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">=</span>8<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">transformer_depth</span><span class="TextSegElement_25805_20316_31526">=</span>4<span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">=</span>8<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">transformer_depth</span><span class="TextSegElement_25805_20316_31526">=</span>4<span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">stem</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">stem</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">BatchNorm2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">BatchNorm2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">BatchNorm2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">BatchNorm2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">patch_embed</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">patch_embed</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">patch_size</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">patch_size</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">patch_size</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">patch_size</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Rotary positional embeddings</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Rotary positional embeddings</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">rotary_emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">RotaryPositionalEmbedding</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">rotary_emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">RotaryPositionalEmbedding</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Gradient checkpointing support</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Gradient checkpointing support</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transformer_blocks</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ModuleList</span><span class="TextSegElement_25805_20316_31526">([</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transformer_blocks</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ModuleList</span><span class="TextSegElement_25805_20316_31526">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">TransformerBlock</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">*</span>4<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">TransformerBlock</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">*</span>4<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">_</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">transformer_depth</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">_</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">transformer_depth</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">fpn</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ModuleList</span><span class="TextSegElement_25805_20316_31526">([</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">fpn</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ModuleList</span><span class="TextSegElement_25805_20316_31526">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">classifier</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">classifier</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">AdaptiveAvgPool2d</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">AdaptiveAvgPool2d</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Flatten</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Flatten</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> 512<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> 512<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span>512<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span>512<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">stem</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">stem</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">patch_embed</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">patch_embed</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">C</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">H</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">W</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">shape</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">C</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">H</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">W</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">shape</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">flatten</span><span class="TextSegElement_25805_20316_31526">(</span>2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">flatten</span><span class="TextSegElement_25805_20316_31526">(</span>2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Use rotary positional embeddings</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Use rotary positional embeddings</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">rotary_pos_emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">rotary_emb</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">rotary_pos_emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">rotary_emb</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">rotary_pos_emb</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">rotary_pos_emb</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Optional gradient checkpointing</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Optional gradient checkpointing</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">transformer_block</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transformer_blocks</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">transformer_block</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transformer_blocks</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">transformer_block</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">transformer_block</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_transformed</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">view</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25805_20316_31526">-</span>1<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">H</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">W</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_transformed</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">view</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25805_20316_31526">-</span>1<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">H</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">W</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">fpn_features</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">fpn_layer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_transformed</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">fpn_layer</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">fpn</span><span class="TextSegElement_25805_20316_31526">]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">fpn_features</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">fpn_layer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_transformed</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">fpn_layer</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">fpn</span><span class="TextSegElement_25805_20316_31526">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_final</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">fpn_features</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_final</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">fpn_features</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">classifier</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_final</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">classifier</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_final</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">HybridFPNTransformer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">class</span> <span class="TextSegElement_35782_21035_31526">HybridFPNTransformer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">image_size</span><span class="TextSegElement_25805_20316_31526">=</span>224<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">patch_size</span><span class="TextSegElement_25805_20316_31526">=</span>16<span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">image_size</span><span class="TextSegElement_25805_20316_31526">=</span>224<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">patch_size</span><span class="TextSegElement_25805_20316_31526">=</span>16<span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">=</span>8<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">transformer_depth</span><span class="TextSegElement_25805_20316_31526">=</span>4<span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">=</span>256<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">=</span>8<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">transformer_depth</span><span class="TextSegElement_25805_20316_31526">=</span>4<span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">super</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">__init__</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">stem</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">stem</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">BatchNorm2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">BatchNorm2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">//</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span>2<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">BatchNorm2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">BatchNorm2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">patch_embed</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">patch_embed</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">patch_size</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">patch_size</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">patch_size</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">stride</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">patch_size</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Rotary positional embeddings</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Rotary positional embeddings</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">rotary_emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">RotaryPositionalEmbedding</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">rotary_emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">RotaryPositionalEmbedding</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Gradient checkpointing support</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Gradient checkpointing support</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transformer_blocks</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ModuleList</span><span class="TextSegElement_25805_20316_31526">([</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transformer_blocks</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ModuleList</span><span class="TextSegElement_25805_20316_31526">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">TransformerBlock</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">*</span>4<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">TransformerBlock</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_heads</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">*</span>4<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">_</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">transformer_depth</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">_</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">transformer_depth</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">fpn</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ModuleList</span><span class="TextSegElement_25805_20316_31526">([</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">fpn</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ModuleList</span><span class="TextSegElement_25805_20316_31526">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Conv2d</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">kernel_size</span><span class="TextSegElement_25805_20316_31526">=</span>3<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">padding</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">classifier</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">classifier</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Sequential</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">AdaptiveAvgPool2d</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">AdaptiveAvgPool2d</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Flatten</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Flatten</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> 512<span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">embed_dim</span><span class="TextSegElement_25805_20316_31526">,</span> 512<span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ReLU</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inplace</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Dropout</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span>512<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Linear</span><span class="TextSegElement_25805_20316_31526">(</span>512<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">forward</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">stem</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">stem</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">patch_embed</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">patch_embed</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">C</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">H</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">W</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">shape</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">C</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">H</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">W</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">shape</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">flatten</span><span class="TextSegElement_25805_20316_31526">(</span>2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">flatten</span><span class="TextSegElement_25805_20316_31526">(</span>2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Use rotary positional embeddings</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Use rotary positional embeddings</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">rotary_pos_emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">rotary_emb</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">rotary_pos_emb</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">rotary_emb</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">rotary_pos_emb</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">rotary_pos_emb</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Optional gradient checkpointing</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Optional gradient checkpointing</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">transformer_block</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transformer_blocks</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">transformer_block</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transformer_blocks</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">transformer_block</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_patches</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">transformer_block</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_transformed</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">view</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25805_20316_31526">-</span>1<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">H</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">W</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_transformed</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">x_patches</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">transpose</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> 2<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">view</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">B</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25805_20316_31526">-</span>1<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">H</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">W</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">fpn_features</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">fpn_layer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_transformed</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">fpn_layer</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">fpn</span><span class="TextSegElement_25805_20316_31526">]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">fpn_features</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">fpn_layer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_transformed</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">fpn_layer</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">fpn</span><span class="TextSegElement_25805_20316_31526">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_final</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">fpn_features</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">x_final</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">fpn_features</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">classifier</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_final</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">self</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">classifier</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">x_final</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">setup_logging</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">setup_logging</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span>: <span class="TextSegElement_35782_21035_31526">str</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span>: <span class="TextSegElement_35782_21035_31526">str</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_level</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">INFO</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_level</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">INFO</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">verbose</span>: <span class="TextSegElement_35782_21035_31526">bool</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_20851_38190_23383">False</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">verbose</span>: <span class="TextSegElement_35782_21035_31526">bool</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_20851_38190_23383">False</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">-&gt;</span> <span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Logger</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">-&gt;</span> <span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Logger</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Generate more detailed log filename</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Generate more detailed log filename</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_filename</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_filename</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'tumor_classification_{datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)}.log'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'tumor_classification_{datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)}.log'</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Configure logging with more details</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Configure logging with more details</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">basicConfig</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">basicConfig</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">level</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">log_level</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">level</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">log_level</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">format</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'%(asctime)s - %(name)s - %(levelname)s: %(message)s'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">format</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'%(asctime)s - %(name)s - %(levelname)s: %(message)s'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">handlers</span><span class="TextSegElement_25805_20316_31526">=[</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">handlers</span><span class="TextSegElement_25805_20316_31526">=[</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">FileHandler</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_filename</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">FileHandler</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_filename</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">StreamHandler</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">StreamHandler</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">getLogger</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'TumorClassification'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">logging</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">getLogger</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'TumorClassification'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Add hardware information logging</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Add hardware information logging</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">verbose</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">verbose</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Device: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else 'CPU'}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Device: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else 'CPU'}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;CUDA Available: {torch.cuda.is_available()}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;CUDA Available: {torch.cuda.is_available()}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">logger</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">logger</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">calculate_metrics</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">calculate_metrics</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Calculate metrics with weighted average for multiclass</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Calculate metrics with weighted average for multiclass</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">f1</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">f1_score</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">average</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'weighted'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">f1</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">f1_score</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">average</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'weighted'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">precision</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">precision_score</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">average</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'weighted'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">precision</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">precision_score</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">average</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'weighted'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">recall</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">recall_score</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">average</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'weighted'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">recall</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">recall_score</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">average</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'weighted'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Confusion Matrix</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Confusion Matrix</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">cm</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">confusion_matrix</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">cm</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">confusion_matrix</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">true_labels</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">pred_labels</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Sensitivity (Per Class) derived from confusion matrix</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Sensitivity (Per Class) derived from confusion matrix</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">sensitivity</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">sensitivity</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">i</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">i</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">tp</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">cm</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">i</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">i</span><span class="TextSegElement_25805_20316_31526">]</span><span class="TextSegElement_27880_37322">&nbsp; # True positives for class i</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">tp</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">cm</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">i</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">i</span><span class="TextSegElement_25805_20316_31526">]</span><span class="TextSegElement_27880_37322">&nbsp; # True positives for class i</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">fn</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">cm</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">i</span><span class="TextSegElement_25805_20316_31526">,</span> :<span class="TextSegElement_25805_20316_31526">].</span><span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_25805_20316_31526">-</span> <span class="TextSegElement_35782_21035_31526">tp</span><span class="TextSegElement_27880_37322">&nbsp; # False negatives for class i</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">fn</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">cm</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">i</span><span class="TextSegElement_25805_20316_31526">,</span> :<span class="TextSegElement_25805_20316_31526">].</span><span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_25805_20316_31526">-</span> <span class="TextSegElement_35782_21035_31526">tp</span><span class="TextSegElement_27880_37322">&nbsp; # False negatives for class i</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">sensitivity</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">tp</span> <span class="TextSegElement_25805_20316_31526">/</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">tp</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">fn</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">tp</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">fn</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">&gt;</span> 0 <span class="TextSegElement_20851_38190_23383">else</span> 0<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">sensitivity</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">tp</span> <span class="TextSegElement_25805_20316_31526">/</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">tp</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">fn</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">tp</span> <span class="TextSegElement_25805_20316_31526">+</span> <span class="TextSegElement_35782_21035_31526">fn</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">&gt;</span> 0 <span class="TextSegElement_20851_38190_23383">else</span> 0<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_25805_20316_31526">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_25805_20316_31526">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'f1_score'</span>: <span class="TextSegElement_35782_21035_31526">f1</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'f1_score'</span>: <span class="TextSegElement_35782_21035_31526">f1</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'precision'</span>: <span class="TextSegElement_35782_21035_31526">precision</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'precision'</span>: <span class="TextSegElement_35782_21035_31526">precision</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'recall'</span>: <span class="TextSegElement_35782_21035_31526">recall</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'recall'</span>: <span class="TextSegElement_35782_21035_31526">recall</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span>: <span class="TextSegElement_35782_21035_31526">sensitivity</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span>: <span class="TextSegElement_35782_21035_31526">sensitivity</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'confusion_matrix'</span>: <span class="TextSegElement_35782_21035_31526">cm</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'confusion_matrix'</span>: <span class="TextSegElement_35782_21035_31526">cm</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">save_metrics_to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">save_metrics_to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Ensure the directory exists</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Ensure the directory exists</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">dirname</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">dirname</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">with</span> <span class="TextSegElement_35782_21035_31526">open</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">mode</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'w'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">newline</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">''</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">file</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">with</span> <span class="TextSegElement_35782_21035_31526">open</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">mode</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'w'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">newline</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">''</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">as</span> <span class="TextSegElement_35782_21035_31526">file</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">csv</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">file</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">csv</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">file</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Write the header</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Write the header</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">headers</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'Epoch'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Train_F1'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Train_Precision'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Train_Recall'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">headers</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'Epoch'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Train_F1'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Train_Precision'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Train_Recall'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_23383_31526_20018">'Train_Sensitivity'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Train_Confusion_Matrix'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_23383_31526_20018">'Train_Sensitivity'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Train_Confusion_Matrix'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_23383_31526_20018">'Val_F1'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Val_Precision'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Val_Recall'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_23383_31526_20018">'Val_F1'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Val_Precision'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Val_Recall'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_23383_31526_20018">'Val_Sensitivity'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Val_Confusion_Matrix'</span><span class="TextSegElement_25805_20316_31526">]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegElement_23383_31526_20018">'Val_Sensitivity'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'Val_Confusion_Matrix'</span><span class="TextSegElement_25805_20316_31526">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">writerow</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">headers</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">writerow</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">headers</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Write metrics for each epoch</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Write metrics for each epoch</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">enumerate</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">zip</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">start</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">enumerate</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">zip</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">start</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">writerow</span><span class="TextSegElement_25805_20316_31526">([</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">writerow</span><span class="TextSegElement_25805_20316_31526">([</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">str</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'confusion_matrix'</span><span class="TextSegElement_25805_20316_31526">].</span><span class="TextSegElement_35782_21035_31526">tolist</span><span class="TextSegElement_25805_20316_31526">()),</span><span class="TextSegElement_27880_37322">&nbsp; # Convert to string</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">str</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'confusion_matrix'</span><span class="TextSegElement_25805_20316_31526">].</span><span class="TextSegElement_35782_21035_31526">tolist</span><span class="TextSegElement_25805_20316_31526">()),</span><span class="TextSegElement_27880_37322">&nbsp; # Convert to string</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">str</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'confusion_matrix'</span><span class="TextSegElement_25805_20316_31526">].</span><span class="TextSegElement_35782_21035_31526">tolist</span><span class="TextSegElement_25805_20316_31526">())</span><span class="TextSegElement_27880_37322">&nbsp; # Convert to string</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">str</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'confusion_matrix'</span><span class="TextSegElement_25805_20316_31526">].</span><span class="TextSegElement_35782_21035_31526">tolist</span><span class="TextSegElement_25805_20316_31526">())</span><span class="TextSegElement_27880_37322">&nbsp; # Convert to string</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">print</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Metrics saved to {csv_path}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">print</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Metrics saved to {csv_path}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">plot_metrics</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">save_dir</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">plot_metrics</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">save_dir</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Ensure the save directory exists</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Ensure the save directory exists</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">save_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">save_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Prepare metrics for plotting</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Prepare metrics for plotting</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">epochs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">len</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">+</span> 1<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">epochs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span>1<span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">len</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">+</span> 1<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">metrics_to_plot</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">metrics_to_plot</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">metric</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">metrics_to_plot</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">metric</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">metrics_to_plot</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">figure</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">figsize</span><span class="TextSegElement_25805_20316_31526">=(</span>10<span class="TextSegElement_25805_20316_31526">,</span> 6<span class="TextSegElement_25805_20316_31526">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">figure</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">figsize</span><span class="TextSegElement_25805_20316_31526">=(</span>10<span class="TextSegElement_25805_20316_31526">,</span> 6<span class="TextSegElement_25805_20316_31526">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_values</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">epoch_metrics</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">]</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">metric</span> <span class="TextSegElement_25805_20316_31526">!=</span> <span class="TextSegElement_23383_31526_20018">'sensitivity'</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">epoch_metrics</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">])</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">epoch_metrics</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_values</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">epoch_metrics</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">]</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">metric</span> <span class="TextSegElement_25805_20316_31526">!=</span> <span class="TextSegElement_23383_31526_20018">'sensitivity'</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">epoch_metrics</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">])</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">epoch_metrics</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_values</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">epoch_metrics</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">]</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">metric</span> <span class="TextSegElement_25805_20316_31526">!=</span> <span class="TextSegElement_23383_31526_20018">'sensitivity'</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">epoch_metrics</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">])</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">epoch_metrics</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_values</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">epoch_metrics</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">]</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">metric</span> <span class="TextSegElement_25805_20316_31526">!=</span> <span class="TextSegElement_23383_31526_20018">'sensitivity'</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">epoch_metrics</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">])</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">epoch_metrics</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">plot</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">epochs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_values</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">label</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'Train {metric}'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">marker</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'o'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">plot</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">epochs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_values</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">label</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'Train {metric}'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">marker</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'o'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">plot</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">epochs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_values</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">label</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'Validation {metric}'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">marker</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'o'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">plot</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">epochs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_values</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">label</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'Validation {metric}'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">marker</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'o'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">title</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'{metric.capitalize()} over Epochs'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">title</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'{metric.capitalize()} over Epochs'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">xlabel</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Epochs'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">xlabel</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Epochs'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ylabel</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">capitalize</span><span class="TextSegElement_25805_20316_31526">())</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ylabel</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">metric</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">capitalize</span><span class="TextSegElement_25805_20316_31526">())</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">legend</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">legend</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">grid</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">grid</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ylim</span><span class="TextSegElement_25805_20316_31526">(</span>0<span class="TextSegElement_25805_20316_31526">,</span> 1<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">ylim</span><span class="TextSegElement_25805_20316_31526">(</span>0<span class="TextSegElement_25805_20316_31526">,</span> 1<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Save the plot as an image</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Save the plot as an image</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">save_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">save_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'{metric}.png'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">save_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">save_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'{metric}.png'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">savefig</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">save_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">savefig</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">save_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">print</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Saved plot for {metric} to {save_path}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">print</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Saved plot for {metric} to {save_path}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">close</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plt</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">close</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">train_model_enhanced</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">train_model_enhanced</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span>: <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span>: <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loader</span>: <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">data</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loader</span>: <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">data</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loader</span>: <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">data</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loader</span>: <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">data</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataLoader</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span>: <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span>: <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span>: <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">optim</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Optimizer</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span>: <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">optim</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Optimizer</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_epochs</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> 150<span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_epochs</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> 150<span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span>: <span class="TextSegElement_35782_21035_31526">Optional</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">]</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_20851_38190_23383">None</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span>: <span class="TextSegElement_35782_21035_31526">Optional</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">]</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_20851_38190_23383">None</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> 4<span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> 4<span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span>: <span class="TextSegElement_35782_21035_31526">str</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span>: <span class="TextSegElement_35782_21035_31526">str</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span>: <span class="TextSegElement_35782_21035_31526">str</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'/kaggle/working'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span>: <span class="TextSegElement_35782_21035_31526">str</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'/kaggle/working'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model_name</span>&nbsp; <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_20851_38190_23383">None</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model_name</span>&nbsp; <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_20851_38190_23383">None</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">early_stopping_patience</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> 10<span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">early_stopping_patience</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> 10<span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">learning_rate_patience</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> 5</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">learning_rate_patience</span>: <span class="TextSegElement_35782_21035_31526">int</span> <span class="TextSegElement_25805_20316_31526">=</span> 5</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">-&gt;</span> <span class="TextSegElement_35782_21035_31526">Tuple</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">List</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">Dict</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">List</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">Dict</span><span class="TextSegElement_25805_20316_31526">]]</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_25805_20316_31526">-&gt;</span> <span class="TextSegElement_35782_21035_31526">Tuple</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Module</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">List</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">Dict</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">List</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_35782_21035_31526">Dict</span><span class="TextSegElement_25805_20316_31526">]]</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Device management</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Device management</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">device</span> <span class="TextSegElement_20851_38190_23383">or</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">&quot;cuda&quot;</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">is_available</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_23383_31526_20018">&quot;cpu&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">device</span> <span class="TextSegElement_20851_38190_23383">or</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">&quot;cuda&quot;</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">is_available</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_23383_31526_20018">&quot;cpu&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">model_name</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">model_name</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">model_name</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">model_name</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Logging and TensorBoard</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Logging and TensorBoard</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">setup_logging</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">verbose</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">setup_logging</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">verbose</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">SummaryWriter</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">SummaryWriter</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Learning rate scheduler</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Learning rate scheduler</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">scheduler</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">ReduceLROnPlateau</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">scheduler</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">ReduceLROnPlateau</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">mode</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'max'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">mode</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'max'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">factor</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">factor</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_25968_23383">0.5</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">patience</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">learning_rate_patience</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">patience</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">learning_rate_patience</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Early stopping variables</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Early stopping variables</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">best_val_f1</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25968_23383">0.0</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">best_val_f1</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25968_23383">0.0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">epochs_no_improve</span> <span class="TextSegElement_25805_20316_31526">=</span> 0</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">epochs_no_improve</span> <span class="TextSegElement_25805_20316_31526">=</span> 0</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[],</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[],</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">epoch</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_epochs</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">epoch</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">range</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_epochs</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">train</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loss</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25968_23383">0.0</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loss</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25968_23383">0.0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_preds</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_true</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[],</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_preds</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_true</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[],</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">batch_idx</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">enumerate</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">batch_idx</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">)</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">enumerate</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">)</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">zero_grad</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">zero_grad</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">outputs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">outputs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">loss</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">outputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">loss</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">outputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">loss</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">backward</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">loss</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">backward</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Optional gradient clipping</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Optional gradient clipping</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">clip_grad_norm_</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">(),</span> <span class="TextSegElement_35782_21035_31526">max_norm</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_25968_23383">1.0</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">utils</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">clip_grad_norm_</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">(),</span> <span class="TextSegElement_35782_21035_31526">max_norm</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_25968_23383">1.0</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">step</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">step</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loss</span> <span class="TextSegElement_25805_20316_31526">+=</span> <span class="TextSegElement_35782_21035_31526">loss</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">item</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loss</span> <span class="TextSegElement_25805_20316_31526">+=</span> <span class="TextSegElement_35782_21035_31526">loss</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">item</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">_</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">predicted</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">max</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">outputs</span><span class="TextSegElement_25805_20316_31526">,</span> 1<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">_</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">predicted</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">max</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">outputs</span><span class="TextSegElement_25805_20316_31526">,</span> 1<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_preds</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">extend</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">predicted</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cpu</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">numpy</span><span class="TextSegElement_25805_20316_31526">())</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_preds</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">extend</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">predicted</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cpu</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">numpy</span><span class="TextSegElement_25805_20316_31526">())</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_true</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">extend</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cpu</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">numpy</span><span class="TextSegElement_25805_20316_31526">())</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_true</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">extend</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cpu</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">numpy</span><span class="TextSegElement_25805_20316_31526">())</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Validation phase</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Validation phase</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">eval</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">eval</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loss</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25968_23383">0.0</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loss</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25968_23383">0.0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_preds</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_true</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[],</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_preds</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_true</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[],</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">with</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">no_grad</span><span class="TextSegElement_25805_20316_31526">()</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">with</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">no_grad</span><span class="TextSegElement_25805_20316_31526">()</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">val_loader</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">val_loader</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">outputs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">outputs</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">inputs</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">loss</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">outputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">loss</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">outputs</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loss</span> <span class="TextSegElement_25805_20316_31526">+=</span> <span class="TextSegElement_35782_21035_31526">loss</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">item</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loss</span> <span class="TextSegElement_25805_20316_31526">+=</span> <span class="TextSegElement_35782_21035_31526">loss</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">item</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">_</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">predicted</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">max</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">outputs</span><span class="TextSegElement_25805_20316_31526">,</span> 1<span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">_</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">predicted</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">max</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">outputs</span><span class="TextSegElement_25805_20316_31526">,</span> 1<span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_preds</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">extend</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">predicted</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cpu</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">numpy</span><span class="TextSegElement_25805_20316_31526">())</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_preds</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">extend</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">predicted</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cpu</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">numpy</span><span class="TextSegElement_25805_20316_31526">())</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_true</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">extend</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cpu</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">numpy</span><span class="TextSegElement_25805_20316_31526">())</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_true</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">extend</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">labels</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cpu</span><span class="TextSegElement_25805_20316_31526">().</span><span class="TextSegElement_35782_21035_31526">numpy</span><span class="TextSegElement_25805_20316_31526">())</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Metrics calculation (similar to original function)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Metrics calculation (similar to original function)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">calculate_metrics</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">calculate_metrics</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">array</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_true</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">array</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_true</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">array</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_preds</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">array</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_preds</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">calculate_metrics</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">calculate_metrics</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">array</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_true</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">array</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_true</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">array</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_preds</span><span class="TextSegElement_25805_20316_31526">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">array</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_preds</span><span class="TextSegElement_25805_20316_31526">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # TensorBoard logging</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # TensorBoard logging</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Loss/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_loss</span><span class="TextSegElement_25805_20316_31526">/</span><span class="TextSegElement_35782_21035_31526">len</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Loss/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_loss</span><span class="TextSegElement_25805_20316_31526">/</span><span class="TextSegElement_35782_21035_31526">len</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Loss/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_loss</span><span class="TextSegElement_25805_20316_31526">/</span><span class="TextSegElement_35782_21035_31526">len</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_loader</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Loss/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_loss</span><span class="TextSegElement_25805_20316_31526">/</span><span class="TextSegElement_35782_21035_31526">len</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_loader</span><span class="TextSegElement_25805_20316_31526">),</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'F1/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'F1/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'F1/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'F1/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Precision/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Precision/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Precision/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Precision/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'precision'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Recall/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Recall/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Recall/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Recall/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'recall'</span><span class="TextSegElement_25805_20316_31526">],</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Sensitivity/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">]),</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Sensitivity/Train'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">]),</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Sensitivity/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">]),</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">add_scalar</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'Sensitivity/Validation'</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">np</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">mean</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'sensitivity'</span><span class="TextSegElement_25805_20316_31526">]),</span> <span class="TextSegElement_35782_21035_31526">epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Learning rate scheduling</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Learning rate scheduling</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">scheduler</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">step</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">scheduler</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">step</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Early stopping</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Early stopping</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">]</span> <span class="TextSegElement_25805_20316_31526">&gt;</span> <span class="TextSegElement_35782_21035_31526">best_val_f1</span> <span class="TextSegElement_20851_38190_23383">and</span> <span class="TextSegElement_35782_21035_31526">epoch</span> <span class="TextSegElement_25805_20316_31526">&gt;=</span>50:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">]</span> <span class="TextSegElement_25805_20316_31526">&gt;</span> <span class="TextSegElement_35782_21035_31526">best_val_f1</span> <span class="TextSegElement_20851_38190_23383">and</span> <span class="TextSegElement_35782_21035_31526">epoch</span> <span class="TextSegElement_25805_20316_31526">&gt;=</span>50:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">best_val_f1</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">]</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">best_val_f1</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">[</span><span class="TextSegElement_23383_31526_20018">'f1_score'</span><span class="TextSegElement_25805_20316_31526">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">epochs_no_improve</span> <span class="TextSegElement_25805_20316_31526">=</span> 0</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">epochs_no_improve</span> <span class="TextSegElement_25805_20316_31526">=</span> 0</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Save best model</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Save best model</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">save</span><span class="TextSegElement_25805_20316_31526">({</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">save</span><span class="TextSegElement_25805_20316_31526">({</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'model_state_dict'</span>: <span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">state_dict</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'model_state_dict'</span>: <span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">state_dict</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'optimizer_state_dict'</span>: <span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">state_dict</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'optimizer_state_dict'</span>: <span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">state_dict</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'best_f1'</span>: <span class="TextSegElement_35782_21035_31526">best_val_f1</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'best_f1'</span>: <span class="TextSegElement_35782_21035_31526">best_val_f1</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'epoch'</span>: <span class="TextSegElement_35782_21035_31526">epoch</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'epoch'</span>: <span class="TextSegElement_35782_21035_31526">epoch</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">},</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'best_{model_name}_{epoch}_f1_{best_val_f1:.4f}.pth'</span><span class="TextSegElement_25805_20316_31526">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">},</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">checkpoint_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">'best_{model_name}_{epoch}_f1_{best_val_f1:.4f}.pth'</span><span class="TextSegElement_25805_20316_31526">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # elif epoch &lt;=50:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # elif epoch &lt;=50:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; epochs_no_improve = 0</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; epochs_no_improve = 0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # else:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # else:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; epochs_no_improve += 0</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; epochs_no_improve += 0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Log epoch summary</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Log epoch summary</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Epoch {epoch+1}/{num_epochs}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Epoch {epoch+1}/{num_epochs}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Train F1: {train_metrics_epoch['f1_score']:.4f}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Train F1: {train_metrics_epoch['f1_score']:.4f}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Val F1: {val_metrics_epoch['f1_score']:.4f}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Val F1: {val_metrics_epoch['f1_score']:.4f}&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Early stopping check</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # Early stopping check</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">epochs_no_improve</span> <span class="TextSegElement_25805_20316_31526">&gt;=</span> <span class="TextSegElement_35782_21035_31526">early_stopping_patience</span>:</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">epochs_no_improve</span> <span class="TextSegElement_25805_20316_31526">&gt;=</span> <span class="TextSegElement_35782_21035_31526">early_stopping_patience</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Early stopping triggered after {epoch+1} epochs&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">logger</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">info</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">f</span><span class="TextSegElement_23383_31526_20018">&quot;Early stopping triggered after {epoch+1} epochs&quot;</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">break</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">break</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">train_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_metrics</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">val_metrics_epoch</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Close TensorBoard writer</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Close TensorBoard writer</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">close</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">writer</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">close</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">return</span> <span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">val_metrics</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">import</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">os</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">import</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">re</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">import</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">time</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">import</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">torch</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff"># Function to find highest F1 score files</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">def</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">find_highest_f1_files</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">base_dir</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">&quot;/kaggle/working/&quot;</span><span class="TextSegSigDiff">)</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">highest_f1_files</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">[]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # Iterate through each folder in the base directory</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">for</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">folder_name</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">in</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">os</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">listdir</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">base_dir</span><span class="TextSegSigDiff">)</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">folder_path</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">os</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">path</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">join</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">base_dir</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">folder_name</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">os</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">path</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">isdir</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">folder_path</span><span class="TextSegSigDiff">)</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">max_f1</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">-</span><span class="TextSegSigDiff">1</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">max_file</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">&quot;&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">max_epoch</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">-</span><span class="TextSegSigDiff">1</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Iterate through each file in the folder</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">for</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">file_name</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">in</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">os</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">listdir</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">folder_path</span><span class="TextSegSigDiff">)</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">file_path</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">os</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">path</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">join</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">folder_path</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">file_name</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Use regex to extract the epoch and F1 score from the file name</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">match</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">re</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">search</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">r</span><span class="TextSegSigDiff">&quot;best_\w+_(\d+)_f1_(\d+\.\d+)\.pth&quot;</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">file_name</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">match</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">epoch</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">int</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">match</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">group</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">1</span><span class="TextSegSigDiff">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">f1_score</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">float</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">match</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">group</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">2</span><span class="TextSegSigDiff">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Update the highest F1 score and corresponding file path</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">f1_score</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">&gt;</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">max_f1</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">or</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">f1_score</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">==</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">max_f1</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">and</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">epoch</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">&gt;</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">max_epoch</span><span class="TextSegSigDiff">)</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">max_f1</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">f1_score</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">max_file</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">file_path</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">max_epoch</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">epoch</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">max_file</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">highest_f1_files</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">append</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">max_file</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">return</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">highest_f1_files</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff"># Function for inference</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">def</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">evaluate_model</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">model_path</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">dataloader</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">device</span><span class="TextSegSigDiff">)</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # Load the model</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">model</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">torch</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">load</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">model_path</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">map_location</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">device</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">model</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">eval</span><span class="TextSegSigDiff">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">correct</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">total</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">inference_times</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">[]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # Iterate through the dataset</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">with</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">torch</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">no_grad</span><span class="TextSegSigDiff">()</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">for</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">images</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">labels</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">in</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">dataloader</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">images</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">labels</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">images</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">to</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">device</span><span class="TextSegSigDiff">),</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">labels</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">to</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">device</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Record start time</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">start_time</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">time</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">time</span><span class="TextSegSigDiff">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Perform inference</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">outputs</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">images</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">_</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">predicted</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">torch</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">max</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">outputs</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">1</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Record end time</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">end_time</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">time</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">time</span><span class="TextSegSigDiff">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Calculate inference time</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">inference_times</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">append</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">end_time</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">-</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">start_time</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Update accuracy</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">total</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">+=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">labels</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">size</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">0</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">correct</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">+=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">predicted</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">==</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">labels</span><span class="TextSegSigDiff">).</span><span class="TextSegSigDiff">sum</span><span class="TextSegSigDiff">().</span><span class="TextSegSigDiff">item</span><span class="TextSegSigDiff">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # Calculate average inference time and accuracy</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">avg_inference_time</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">sum</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">inference_times</span><span class="TextSegSigDiff">)</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">/</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">len</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">inference_times</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">accuracy</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">100</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">*</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">correct</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">/</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">total</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">return</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">avg_inference_time</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">accuracy</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff"># EPOCHS_NUM = 160</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">EPOCHS_NUM</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">1</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">main</span><span class="TextSegElement_25805_20316_31526">()</span>:</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">def</span> <span class="TextSegElement_35782_21035_31526">main</span><span class="TextSegElement_25805_20316_31526">()</span>:</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Device configuration</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Device configuration</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'cuda'</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">is_available</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_23383_31526_20018">'cpu'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_23383_31526_20018">'cuda'</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">is_available</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">else</span> <span class="TextSegElement_23383_31526_20018">'cpu'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Log directory setup</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Log directory setup</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">log_dir</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/'</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">makedirs</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">exist_ok</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">True</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # <span class="TextSegInsigDiff"># </span>Define model dictionary</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # Define model dictionary</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # model_dict = {</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">model</span><span class="TextSegSigDiff">_dict</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; 'VGG16': {</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; </span><span class="TextSegSigDiff">'VGG16'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'model': models.vgg16(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">'model'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">models</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">vgg16</span><span class="TextSegSigDiff">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'weights_path': '/kaggle/input/model/pytorch/default/1/vgg16-397923af.pth'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">'weights_path'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">'/kaggle/input/model/pytorch/default/1/vgg16-397923af.pth'</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; },</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; </span><span class="TextSegSigDiff">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; 'ResNet18': {</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; </span><span class="TextSegSigDiff">'ResNet18'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'model': models.resnet18(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">'model'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">models</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">resnet18</span><span class="TextSegSigDiff">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'weights_path': '/kaggle/input/model/pytorch/default/1/resnet18-f37072fd.pth'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">'weights_path'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">'/kaggle/input/model/pytorch/default/1/resnet18-f37072fd.pth'</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; },</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; </span><span class="TextSegSigDiff">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; 'AlexNet': {</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; </span><span class="TextSegSigDiff">'AlexNet'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'model': models.alexnet(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">'model'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">models</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">alexnet</span><span class="TextSegSigDiff">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'weights_path': '/kaggle/input/model/pytorch/default/1/alexnet-owt-7be5be79.pth'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">'weights_path'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">'/kaggle/input/model/pytorch/default/1/alexnet-owt-7be5be79.pth'</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; }</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; </span><span class="TextSegSigDiff">}</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # }</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">}</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionAll">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # <span class="TextSegInsigDiff"># </span>CSV to store training time and parameters</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # CSV to store training time and parameters</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">time_metrics</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">time_metrics</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_25805_20316_31526">[]</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # <span class="TextSegInsigDiff"># </span>Iterate through base models for experimentation</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; # Iterate through base models for experimentation</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # for model_name, model_info in model_dict.items():</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">for</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model_name</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model_info</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">in</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model_dict</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">items</span><span class="TextSegSigDiff">()</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; try:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; </span><span class="TextSegSigDiff">try</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; <span class="TextSegInsigDiff"># </span>&nbsp; &nbsp; &nbsp; &nbsp; # Load pre-trained weights and adjust the classifier layer</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Load pre-trained weights and adjust the classifier layer</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; base_model = model_info['model']</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">base</span><span class="TextSegSigDiff">_model</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model_info</span><span class="TextSegSigDiff">[</span><span class="TextSegSigDiff">'model'</span><span class="TextSegSigDiff">]</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; weights_path = model_info['weights_path']</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">weights</span><span class="TextSegSigDiff">_path</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model_info</span><span class="TextSegSigDiff">[</span><span class="TextSegSigDiff">'weights_path'</span><span class="TextSegSigDiff">]</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; base_model.load_state_dict(torch.load(weights_path))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">base</span><span class="TextSegSigDiff">_model</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">load_state_dict</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">torch</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">load</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">weights_path</span><span class="TextSegSigDiff">))</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if model_name in ['VGG16', 'AlexNet']:</span></td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model_name</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">in</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">[</span><span class="TextSegSigDiff">'VGG16'</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">'AlexNet'</span><span class="TextSegSigDiff">]</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; base_model.classifier[-1] = nn.Linear(base_model.classifier[-1].in_features, 4)</span>&nbsp; # Adjust for 4 classes</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">base</span><span class="TextSegSigDiff">_model</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">classifier</span><span class="TextSegSigDiff">[-</span><span class="TextSegSigDiff">1</span><span class="TextSegSigDiff">]</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">nn</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Linear</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">base_model</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">classifier</span><span class="TextSegSigDiff">[-</span><span class="TextSegSigDiff">1</span><span class="TextSegSigDiff">].</span><span class="TextSegSigDiff">in_features</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">4</span><span class="TextSegSigDiff">)</span>&nbsp; # Adjust for 4 classes</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; elif model_name == 'ResNet18':</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">elif</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model_name</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">==</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">'ResNet18'</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; base_model.fc = nn.Linear(base_model.fc.in_features, 4)</span>&nbsp; # Adjust for 4 classes</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">base</span><span class="TextSegSigDiff">_model</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">fc</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">nn</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Linear</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">base_model</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">fc</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">in_features</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">4</span><span class="TextSegSigDiff">)</span>&nbsp; # Adjust for 4 classes</td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionAll">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; base_model = base_model.to(device)</span></td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">base</span><span class="TextSegSigDiff">_model</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">base_model</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">to</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">device</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; <span class="TextSegInsigDiff"># </span>&nbsp; &nbsp; &nbsp; &nbsp; # Define loss and optimizer</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Define loss and optimizer</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegInsigDiff"> criterion = nn.CrossEntropyLoss()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">criterion</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">nn</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">CrossEntropyLoss</span><span class="TextSegSigDiff">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; optimizer = optim.Adam(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">optimizer</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">optim</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">Adam</span><span class="TextSegSigDiff">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; base_model.parameters(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">base</span><span class="TextSegSigDiff">_model</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">parameters</span><span class="TextSegSigDiff">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; lr=1e-4,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">lr</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">1</span><span class="TextSegSigDiff">e</span><span class="TextSegSigDiff">-</span><span class="TextSegSigDiff">4</span><span class="TextSegSigDiff">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; weight_decay=1e-5</span>&nbsp; # L2 regularization</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">weight</span><span class="TextSegSigDiff">_decay</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">1</span><span class="TextSegSigDiff">e</span><span class="TextSegSigDiff">-</span><span class="TextSegSigDiff">5</span>&nbsp; # L2 regularization</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; <span class="TextSegInsigDiff"># </span>&nbsp; &nbsp; &nbsp; &nbsp; # Record start time</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Record start time</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; start_time = time.time()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">start</span><span class="TextSegSigDiff">_time</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">time</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">time</span><span class="TextSegSigDiff">()</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; <span class="TextSegInsigDiff"># </span>&nbsp; &nbsp; &nbsp; &nbsp; # Train the model</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Train the model</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; trained_model, train_metrics, val_metrics = train_model_enhanced(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">trained</span><span class="TextSegSigDiff">_model</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">train_metrics</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">val_metrics</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">train_model_enhanced</span><span class="TextSegSigDiff">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; model=base_model,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">model</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">base_model</span><span class="TextSegSigDiff">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; train_loader=train_loader,</span>&nbsp; # Assuming this is defined elsewhere</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">train</span><span class="TextSegSigDiff">_loader</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">train_loader</span><span class="TextSegSigDiff">,</span>&nbsp; # Assuming this is defined elsewhere</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; val_loader=val_loader,</span>&nbsp; &nbsp; &nbsp; # Assuming this is defined elsewhere</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">val</span><span class="TextSegSigDiff">_loader</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">val_loader</span><span class="TextSegSigDiff">,</span>&nbsp; &nbsp; &nbsp; # Assuming this is defined elsewhere</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; criterion=criterion,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">criterion</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">criterion</span><span class="TextSegSigDiff">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; optimizer=optimizer,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">optimizer</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">optimizer</span><span class="TextSegSigDiff">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; num_</span><span class="TextSegInsigDiff">epochs=110,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">num</span><span class="TextSegSigDiff">_epochs</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">EPOCHS_NUM</span><span class="TextSegSigDiff">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; model_name=model_name,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">model</span><span class="TextSegSigDiff">_name</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">model_name</span><span class="TextSegSigDiff">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; device=device,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">device</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">device</span><span class="TextSegSigDiff">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; num_classes=4</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">num</span><span class="TextSegSigDiff">_classes</span><span class="TextSegSigDiff">=</span><span class="TextSegSigDiff">4</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; <span class="TextSegInsigDiff"># </span>&nbsp; &nbsp; &nbsp; &nbsp; # Record end time and calculate training duration</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Record end time and calculate training duration</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; end_time = time.time()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">end</span><span class="TextSegSigDiff">_time</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">time</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">time</span><span class="TextSegSigDiff">()</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; training_time = end_time - start_time</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">training</span><span class="TextSegSigDiff">_time</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">end_time</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">-</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">start_time</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; <span class="TextSegInsigDiff"># </span>&nbsp; &nbsp; &nbsp; &nbsp; # Save metrics to CSV</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Save metrics to CSV</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; csv_path = os.path.join(log_dir, f'{model_name}_metrics.csv')</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">csv</span><span class="TextSegSigDiff">_path</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">os</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">path</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">join</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">log_dir</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">f</span><span class="TextSegSigDiff">'{model_name}_metrics.csv'</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; save_metrics_to_csv(train_metrics, val_metrics, csv_path)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">save</span><span class="TextSegSigDiff">_metrics_to_csv</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">train_metrics</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">val_metrics</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">csv_path</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; <span class="TextSegInsigDiff"># </span>&nbsp; &nbsp; &nbsp; &nbsp; # Save metric plots</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Save metric plots</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; plot_path = os.path.join(log_dir, f'{model_name}_plots.png')</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">plot</span><span class="TextSegSigDiff">_path</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">os</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">path</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">join</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">log_dir</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">f</span><span class="TextSegSigDiff">'{model_name}_plots.png'</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; plot_metrics(train_metrics, val_metrics, plot_path)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">plot</span><span class="TextSegSigDiff">_metrics</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">train_metrics</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">val_metrics</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">plot_path</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; <span class="TextSegInsigDiff"># </span>&nbsp; &nbsp; &nbsp; &nbsp; # Log training time and parameters</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Log training time and parameters</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; time_metrics.append({</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">time</span><span class="TextSegSigDiff">_metrics</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">append</span><span class="TextSegSigDiff">({</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'Model': model_name,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">'Model'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model_name</span><span class="TextSegSigDiff">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'Training Time (seconds)': training_time,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">'Training Time (seconds)'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">training_time</span><span class="TextSegSigDiff">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 'Number of Parameters': sum(p.numel() for p in base_model.parameters() if p.requires_grad)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">'Number of Parameters'</span><span class="TextSegSigDiff">:</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">sum</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">p</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">numel</span><span class="TextSegSigDiff">()</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">for</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">p</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">in</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">base_model</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">parameters</span><span class="TextSegSigDiff">()</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">p</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">requires_grad</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; })</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">})</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemInsigMod">&nbsp;&nbsp;&nbsp; <span class="TextSegInsigDiff"># </span>&nbsp; &nbsp; &nbsp; &nbsp; # Clear VRAM</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # Clear VRAM</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; del base_model, criterion, optimizer, trained_model</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">del</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">base_model</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">criterion</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">optimizer</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">trained_model</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; torch.cuda.empty_cache()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">torch</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">cuda</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">empty_cache</span><span class="TextSegSigDiff">()</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp;&nbsp; except Exception as e:</span></td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; </span><span class="TextSegSigDiff">except</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">Exception</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">as</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">e</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print(f&quot;Error processing {model_name}: {e}&quot;)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="TextSegSigDiff">print</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">f</span><span class="TextSegSigDiff">&quot;Error processing {model_name}: {e}&quot;</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # # Save training time and parameter metrics to a CSV</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # # Save training time and parameter metrics to a CSV</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">time_metrics_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'training_time_metrics.csv'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">time_metrics_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">os</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">path</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">join</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">log_dir</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_23383_31526_20018">'training_time_metrics.csv'</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">pd</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataFrame</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics_path</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">index</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">pd</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataFrame</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics_path</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">index</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # HybridFPNTransformer training</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # HybridFPNTransformer training</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">HybridFPNTransformer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">=</span>4<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">HybridFPNTransformer</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">=</span>4<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">CrossEntropyLoss</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">CrossEntropyLoss</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">optim</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Adam</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">optim</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Adam</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">lr</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_35782_21035_31526">e</span><span class="TextSegElement_25805_20316_31526">-</span>4<span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">lr</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_35782_21035_31526">e</span><span class="TextSegElement_25805_20316_31526">-</span>4<span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">weight_decay</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_35782_21035_31526">e</span><span class="TextSegElement_25805_20316_31526">-</span>5<span class="TextSegElement_27880_37322">&nbsp; # L2 regularization</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">weight_decay</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_35782_21035_31526">e</span><span class="TextSegElement_25805_20316_31526">-</span>5<span class="TextSegElement_27880_37322">&nbsp; # L2 regularization</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">start_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">start_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">trained_hybrid_model</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">train_model_enhanced</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">trained_hybrid_model</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">train_model_enhanced</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">hybrid_model</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">hybrid_model</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loader</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">val_loader</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loader</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">val_loader</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSigMod">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; num_epochs=<span class="TextSegSigDiff">160</span>,</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; num_epochs=<span class="TextSegSigDiff">EPOCHS_NUM</span>,</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model_name</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'HybridFPNTransformer'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model_name</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'HybridFPNTransformer'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">=</span>4</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">=</span>4</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">end_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">end_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_training_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">end_time</span> <span class="TextSegElement_25805_20316_31526">-</span> <span class="TextSegElement_35782_21035_31526">start_time</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_training_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">end_time</span> <span class="TextSegElement_25805_20316_31526">-</span> <span class="TextSegElement_35782_21035_31526">start_time</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">csv_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/HybridFPNTransformer_metrics.csv'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">csv_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/HybridFPNTransformer_metrics.csv'</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">save_metrics_to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">hybrid_train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">save_metrics_to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">hybrid_train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plot_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/HybridFPNTransformer_plots.png'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plot_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/HybridFPNTransformer_plots.png'</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plot_metrics</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">hybrid_train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">plot_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plot_metrics</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">hybrid_train_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">plot_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Log HybridFPNTransformer training time and parameters</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Log HybridFPNTransformer training time and parameters</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">({</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">({</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Model'</span>: <span class="TextSegElement_23383_31526_20018">'HybridFPNTransformer'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Model'</span>: <span class="TextSegElement_23383_31526_20018">'HybridFPNTransformer'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Training Time (seconds)'</span>: <span class="TextSegElement_35782_21035_31526">hybrid_training_time</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Training Time (seconds)'</span>: <span class="TextSegElement_35782_21035_31526">hybrid_training_time</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Number of Parameters'</span>: <span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">p</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">numel</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">p</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">hybrid_model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">p</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">requires_grad</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Number of Parameters'</span>: <span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">p</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">numel</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">p</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">hybrid_model</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">p</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">requires_grad</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">})</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">})</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Clear VRAM</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Clear VRAM</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">del</span> <span class="TextSegElement_35782_21035_31526">hybrid_model</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">trained_hybrid_model</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">del</span> <span class="TextSegElement_35782_21035_31526">hybrid_model</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">trained_hybrid_model</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">empty_cache</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">empty_cache</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">pd</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataFrame</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics_path</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">index</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">pd</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataFrame</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics_path</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">index</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">HybridFPNTransformer_gry</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">=</span>4<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">HybridFPNTransformer_gry</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">=</span>4<span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">CrossEntropyLoss</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">nn</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">CrossEntropyLoss</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">optim</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Adam</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">optim</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">Adam</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">(),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">lr</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_35782_21035_31526">e</span><span class="TextSegElement_25805_20316_31526">-</span>4<span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">lr</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_35782_21035_31526">e</span><span class="TextSegElement_25805_20316_31526">-</span>4<span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">weight_decay</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_35782_21035_31526">e</span><span class="TextSegElement_25805_20316_31526">-</span>5<span class="TextSegElement_27880_37322">&nbsp; # L2 regularization</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">weight_decay</span><span class="TextSegElement_25805_20316_31526">=</span>1<span class="TextSegElement_35782_21035_31526">e</span><span class="TextSegElement_25805_20316_31526">-</span>5<span class="TextSegElement_27880_37322">&nbsp; # L2 regularization</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">start_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">start_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_train_metrics_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics_gry</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">train_model_enhanced</span><span class="TextSegElement_25805_20316_31526">(</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_train_metrics_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics_gry</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">train_model_enhanced</span><span class="TextSegElement_25805_20316_31526">(</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # train_loader=train_dataset_gry,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; # train_loader=train_dataset_gry,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">train_loader_gry</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">train_loader</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">train_loader_gry</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loader</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">val_loader_gry</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">val_loader</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">val_loader_gry</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">optimizer</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSigMod">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; num_epochs=<span class="TextSegSigDiff">160</span>,</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; num_epochs=<span class="TextSegSigDiff">EPOCHS_NUM</span>,</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_35782_21035_31526">device</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model_name</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'HybridFPNTransformerGRY'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">model_name</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_23383_31526_20018">'HybridFPNTransformerGRY'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">=</span>4</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">num_classes</span><span class="TextSegElement_25805_20316_31526">=</span>4</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">end_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">end_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">time</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_gry_training_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">end_time</span> <span class="TextSegElement_25805_20316_31526">-</span> <span class="TextSegElement_35782_21035_31526">start_time</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">hybrid_gry_training_time</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_35782_21035_31526">end_time</span> <span class="TextSegElement_25805_20316_31526">-</span> <span class="TextSegElement_35782_21035_31526">start_time</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">csv_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/HybridFPNTransformerGRY_metrics.csv'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">csv_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/HybridFPNTransformerGRY_metrics.csv'</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">save_metrics_to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">hybrid_train_metrics_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">save_metrics_to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">hybrid_train_metrics_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">csv_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plot_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/HybridFPNTransformerGRY_plots.png'</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plot_path</span> <span class="TextSegElement_25805_20316_31526">=</span> <span class="TextSegElement_23383_31526_20018">'./logs/HybridFPNTransformerGRY_plots.png'</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plot_metrics</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">hybrid_val_metrics_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">plot_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">plot_metrics</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">hybrid_val_metrics_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">hybrid_val_metrics</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">plot_path</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Log HybridFPNTransformer training time and parameters</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Log HybridFPNTransformer training time and parameters</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">({</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">append</span><span class="TextSegElement_25805_20316_31526">({</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Model'</span>: <span class="TextSegElement_23383_31526_20018">'HybridFPNTransformerGRY'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Model'</span>: <span class="TextSegElement_23383_31526_20018">'HybridFPNTransformerGRY'</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Training Time (seconds)'</span>: <span class="TextSegElement_35782_21035_31526">hybrid_gry_training_time</span><span class="TextSegElement_25805_20316_31526">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Training Time (seconds)'</span>: <span class="TextSegElement_35782_21035_31526">hybrid_gry_training_time</span><span class="TextSegElement_25805_20316_31526">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Number of Parameters'</span>: <span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">p</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">numel</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">p</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">p</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">requires_grad</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegElement_23383_31526_20018">'Number of Parameters'</span>: <span class="TextSegElement_35782_21035_31526">sum</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">p</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">numel</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">for</span> <span class="TextSegElement_35782_21035_31526">p</span> <span class="TextSegElement_20851_38190_23383">in</span> <span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">parameters</span><span class="TextSegElement_25805_20316_31526">()</span> <span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">p</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">requires_grad</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">})</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_25805_20316_31526">})</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Clear VRAM</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # Clear VRAM</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # del hybrid_model_gry, criterion, optimizer, hybrid_model_gry</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_27880_37322">&nbsp;&nbsp;&nbsp; # del hybrid_model_gry, criterion, optimizer, hybrid_model_gry</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">del</span> <span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">optimizer</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_20851_38190_23383">del</span> <span class="TextSegElement_35782_21035_31526">hybrid_model_gry</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">criterion</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">optimizer</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">empty_cache</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">torch</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">cuda</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">empty_cache</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">pd</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataFrame</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics_path</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">index</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">pd</span><span class="TextSegElement_25805_20316_31526">.</span><span class="TextSegElement_35782_21035_31526">DataFrame</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics</span><span class="TextSegElement_25805_20316_31526">).</span><span class="TextSegElement_35782_21035_31526">to_csv</span><span class="TextSegElement_25805_20316_31526">(</span><span class="TextSegElement_35782_21035_31526">time_metrics_path</span><span class="TextSegElement_25805_20316_31526">,</span> <span class="TextSegElement_35782_21035_31526">index</span><span class="TextSegElement_25805_20316_31526">=</span><span class="TextSegElement_20851_38190_23383">False</span><span class="TextSegElement_25805_20316_31526">)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # inference</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">highest_f1_files</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">find_highest_f1_files</span><span class="TextSegSigDiff">()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">print</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">&quot;highest_f1_files&quot;</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">highest_f1_files</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">device</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">torch</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">device</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">'cuda'</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">torch</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">cuda</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">is_available</span><span class="TextSegSigDiff">()</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">else</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">'cpu'</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; # Evaluate each model</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">for</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">model_path</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">in</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">highest_f1_files</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">avg_inference_time</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">accuracy</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">evaluate_model</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">model_path</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">dataloader</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">device</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">print</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">f</span><span class="TextSegSigDiff">&quot;Model: {model_path}&quot;</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">print</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">f</span><span class="TextSegSigDiff">&quot;Average Inference Time: {avg_inference_time:.4f} seconds&quot;</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">print</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">f</span><span class="TextSegSigDiff">&quot;Accuracy: {accuracy:.2f}%&quot;</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">__name__</span> <span class="TextSegElement_25805_20316_31526">==</span> <span class="TextSegElement_23383_31526_20018">'__main__'</span>:</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElement_20851_38190_23383">if</span> <span class="TextSegElement_35782_21035_31526">__name__</span> <span class="TextSegElement_25805_20316_31526">==</span> <span class="TextSegElement_23383_31526_20018">'__main__'</span>:</td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">main</span><span class="TextSegElement_25805_20316_31526">()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElement_32553_36827">&nbsp;&nbsp;&nbsp; </span><span class="TextSegElement_35782_21035_31526">main</span><span class="TextSegElement_25805_20316_31526">()</span></td>
</tr>
</table>
<br>
</body>
</html>
